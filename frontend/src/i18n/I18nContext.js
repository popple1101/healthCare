// >>> [UPDATED] FILE: src/i18n/I18nContext.js
import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

// 사전은 한 파일에 몰아서 관리 (요구: 미리 준비된 번역 적용, 자동번역 X)
const DICT = {
  ko: {
    LOGIN: '로그인',
    SIGNUP: '회원가입',
    EMAIL: '이메일',
    PASSWORD: '비밀번호',
    PASSWORD_MIN: '비밀번호 (8자리 이상)',
    PASSWORD_CONFIRM: '새 비밀번호 확인',
    INPUT_REQUIRED: '입력 필요',
    ENTER_ID_PW: '아이디와 비밀번호를 입력해주세요.',
    INVALID_CREDENTIALS: '아이디 또는 비밀번호가 올바르지 않습니다.',
    TRY_AGAIN: '다시 시도해주세요.',
    START: '시작',
    HOME_MEAL: '🥗 식단 기록',
    HOME_DATA: '👀 한눈에',
    PROFILE: 'PROFILE',
    QUEST: 'QUEST',
    RANKING: 'RANKING',
    SETTINGS: 'SETTINGS',
    CAMERA: 'CAMERA',
    CAMERA_HINT: '접시가 중앙에 오도록 맞춰주세요',
    PERMISSION_CAMERA_NEEDED: '카메라 권한이 필요합니다',
    PERMISSION_ALLOW: '권한 허용',
    SAVE: '저장',
    RETAKE: '다시 찍기',
    RESULT: '분석 결과',
    GOAL_SETUP: '목표 설정',
    LATER: '나중에 설정',
    CONFIRM: '확인',
    CANCEL: '취소',
    EDIT: '수정',
    EDIT_DONE: '수정 완료',
    FETCHING: '불러오는 중…',
    NO_LIST: '표시할 항목이 없습니다.',
    LOGOUT: '로그아웃',
    LANGUAGE: '언어',
    SOUND: '효과음',
    ON: '켜기',
    OFF: '끄기',
    RECOVERY: '비밀번호 복구',
    RECOVERY_SETUP: '보안질문 설정',
    RECOVERY_START_DESC: '아이디를 입력하면 질문 2개가 출제됩니다.',
    RECOVERY_ID: '아이디(이메일)',
    RECOVERY_START: '질문 받기',
    RECOVERY_ANSWER: '정답 제출',
    RECOVERY_NEW_PW: '새 비밀번호',
    RECOVERY_RESET: '비밀번호 재설정',
    RECOVERY_REGISTER_DESC: '질문 3개를 선택하고 정답/확인으로 등록하세요.',
    QUESTION_BIRTHPLACE: '내가 태어난 곳은?',
    QUESTION_ELEMENTARY_SCHOOL: '내가 다니던 초등학교는?',
    QUESTION_PET_NAME: '내 애완동물 이름은?',
    QUESTION_MOTHER_NAME: '내 어머니 이름은?',
    ANSWER: '정답',
    ANSWER_CONFIRM: '정답 확인',
    SEND: '전송',
    WALK: '걷기',
    PUSHUP: '푸시업',
    SQUAT: '스쿼트',
    DIET: '식단',
    DAILY_QUESTS: '오늘의 일일 퀘스트',
    REWARD: '보상',
    ALL_CLEARED_BONUS: '모두 완료 보너스',
    NEW: '신규',

    // Profile
    PROFILE_TITLE: 'PROFILE',
    LOADING: '불러오는 중…',
    ACCOUNT_INFO: '계정 정보',
    CURRENT_EMAIL: '현재 이메일',
    PROFILE_INFO: '프로필 정보',
    WEIGHT: '체중(kg)',
    HEIGHT: '키(cm)',
    AGE: '나이',
    GENDER: '성별',
    MALE: '남성',
    FEMALE: '여성',
    TARGET_WEIGHT: '목표 체중(kg)',
    TARGET_CALORIES: '목표 칼로리(kcal)',
    UPDATE_OK: '수정이 완료되었습니다.',
    UPDATE_FAIL: '수정에 실패했습니다.',
    EMAIL_INVALID: '이메일 형식이 올바르지 않습니다.',
    PW_TOO_SHORT: '새 비밀번호는 8자 이상이어야 합니다.',
    PW_MISMATCH: '새 비밀번호 확인이 일치하지 않습니다.',
    NUMERIC_ONLY: '숫자 항목은 숫자로 입력하세요.',

    // Quest/Ranking
    DONE: '완료',
    AUTO: '자동',
    LOCATION_OK: '위치 사용 가능',
    LOCATION_NEEDED: '권한 필요: 위치',
    ANDROID_LOCATION_HINT: '정확도 높음, 배터리 최적화 제외 권장',
    ANDROID_ACCURACY_HINT: '정확도 높음, 배터리 최적화 제외 권장', // ✅ 추가 (QuestScreen에서 사용)
    OPEN_SETTINGS: '설정 열기',
    RANKING_EMPTY: '표시할 랭킹이 없습니다.',
    LIST_LOAD_FAIL: '목록을 불러오지 못했습니다.',
    USERS_EMPTY: '표시할 사용자가 없습니다.',
  },

  en: {
    LOGIN: 'Login',
    SIGNUP: 'Sign Up',
    EMAIL: 'Email',
    PASSWORD: 'Password',
    PASSWORD_MIN: 'Password (min 8 chars)',
    PASSWORD_CONFIRM: 'Confirm new password',
    INPUT_REQUIRED: 'Input required',
    ENTER_ID_PW: 'Please enter email and password.',
    INVALID_CREDENTIALS: 'Invalid email or password.',
    TRY_AGAIN: 'Please try again.',
    START: 'Start',
    HOME_MEAL: '🥗 Meals',
    HOME_DATA: '👀 Overview',
    PROFILE: 'PROFILE',
    QUEST: 'QUEST',
    RANKING: 'RANKING',
    SETTINGS: 'SETTINGS',
    CAMERA: 'CAMERA',
    CAMERA_HINT: 'Center the plate in the frame',
    PERMISSION_CAMERA_NEEDED: 'Camera permission needed',
    PERMISSION_ALLOW: 'Allow',
    SAVE: 'Save',
    RETAKE: 'Retake',
    RESULT: 'Result',
    GOAL_SETUP: 'Goal Setup',
    LATER: 'Set later',
    CONFIRM: 'Confirm',
    CANCEL: 'Cancel',
    EDIT: 'Edit',
    EDIT_DONE: 'Saved',
    FETCHING: 'Loading…',
    NO_LIST: 'No items to show.',
    LOGOUT: 'Log out',
    LANGUAGE: 'Language',
    SOUND: 'SFX',
    ON: 'On',
    OFF: 'Off',
    RECOVERY: 'Password Recovery',
    RECOVERY_SETUP: 'Security Q&A',
    RECOVERY_START_DESC: 'Enter your email to get 2 questions.',
    RECOVERY_ID: 'Email',
    RECOVERY_START: 'Get questions',
    RECOVERY_ANSWER: 'Submit answers',
    RECOVERY_NEW_PW: 'New password',
    RECOVERY_RESET: 'Reset password',
    RECOVERY_REGISTER_DESC: 'Pick 3 questions and register answer/confirm.',
    QUESTION_BIRTHPLACE: 'Where was I born?',
    QUESTION_ELEMENTARY_SCHOOL: 'My elementary school?',
    QUESTION_PET_NAME: 'My pet’s name?',
    QUESTION_MOTHER_NAME: 'My mother’s name?',
    ANSWER: 'Answer',
    ANSWER_CONFIRM: 'Confirm',
    SEND: 'Send',
    WALK: 'Walk',
    PUSHUP: 'Push-ups',
    SQUAT: 'Squats',
    DIET: 'Diet',
    DAILY_QUESTS: 'Today’s Daily Quests',
    REWARD: 'Reward',
    ALL_CLEARED_BONUS: 'All-clear bonus',
    NEW: 'New',

    // Profile
    PROFILE_TITLE: 'PROFILE',
    LOADING: 'Loading…',
    ACCOUNT_INFO: 'Account',
    CURRENT_EMAIL: 'Current email',
    PROFILE_INFO: 'Profile',
    WEIGHT: 'Weight (kg)',
    HEIGHT: 'Height (cm)',
    AGE: 'Age',
    GENDER: 'Gender',
    MALE: 'Male',
    FEMALE: 'Female',
    TARGET_WEIGHT: 'Target weight (kg)',
    TARGET_CALORIES: 'Target calories (kcal)',
    UPDATE_OK: 'Updated successfully.',
    UPDATE_FAIL: 'Failed to update.',
    EMAIL_INVALID: 'Invalid email format.',
    PW_TOO_SHORT: 'New password must be at least 8 characters.',
    PW_MISMATCH: 'Password confirmation does not match.',
    NUMERIC_ONLY: 'Please enter numbers only.',

    // Quest/Ranking
    DONE: 'DONE',
    AUTO: 'AUTO',
    LOCATION_OK: 'Location available',
    LOCATION_NEEDED: 'Permission required: Location',
    ANDROID_LOCATION_HINT: 'High accuracy, exclude from battery optimization',
    ANDROID_ACCURACY_HINT: 'High accuracy, exclude from battery optimization', // ✅ 추가
    OPEN_SETTINGS: 'Open settings',
    RANKING_EMPTY: 'No ranking to display.',
    LIST_LOAD_FAIL: 'Failed to load list.',
    USERS_EMPTY: 'No users to display.',
  },

  ja: {
    LOGIN: 'ログイン',
    SIGNUP: '新規登録',
    EMAIL: 'メール',
    PASSWORD: 'パスワード',
    PASSWORD_MIN: 'パスワード（8文字以上）',
    PASSWORD_CONFIRM: '新しいパスワード（確認）',
    INPUT_REQUIRED: '入力必須',
    ENTER_ID_PW: 'メールとパスワードを入力してください。',
    INVALID_CREDENTIALS: 'メールまたはパスワードが違います。',
    TRY_AGAIN: 'もう一度お試しください。',
    START: '開始',
    HOME_MEAL: '🥗 食事記録',
    HOME_DATA: '👀 一覧',
    PROFILE: 'PROFILE',
    QUEST: 'QUEST',
    RANKING: 'RANKING',
    SETTINGS: 'SETTINGS',
    CAMERA: 'カメラ',
    CAMERA_HINT: '皿が中央に来るように合わせてください',
    PERMISSION_CAMERA_NEEDED: 'カメラ権限が必要です',
    PERMISSION_ALLOW: '許可',
    SAVE: '保存',
    RETAKE: '撮り直し',
    RESULT: '結果',
    GOAL_SETUP: '目標設定',
    LATER: '後で設定',
    CONFIRM: '確認',
    CANCEL: 'キャンセル',
    EDIT: '編集',
    EDIT_DONE: '保存しました',
    FETCHING: '読み込み中…',
    NO_LIST: '表示する項目はありません。',
    LOGOUT: 'ログアウト',
    LANGUAGE: '言語',
    SOUND: '効果音',
    ON: 'オン',
    OFF: 'オフ',
    RECOVERY: 'パスワード復旧',
    RECOVERY_SETUP: 'セキュリティ質問',
    RECOVERY_START_DESC: 'メールを入力すると2問が出題されます。',
    RECOVERY_ID: 'メール',
    RECOVERY_START: '質問を取得',
    RECOVERY_ANSWER: '回答送信',
    RECOVERY_NEW_PW: '新しいパスワード',
    RECOVERY_RESET: 'パスワード再設定',
    RECOVERY_REGISTER_DESC: '質問3つを選び、回答/確認で登録します。',
    QUESTION_BIRTHPLACE: '生まれた場所は？',
    QUESTION_ELEMENTARY_SCHOOL: '小学校は？',
    QUESTION_PET_NAME: 'ペットの名前は？',
    QUESTION_MOTHER_NAME: '母の名前は？',
    ANSWER: '回答',
    ANSWER_CONFIRM: '確認',
    SEND: '送信',
    WALK: 'ウォーキング',
    PUSHUP: '腕立て伏せ',
    SQUAT: 'スクワット',
    DIET: '食事',
    DAILY_QUESTS: '本日のデイリークエスト',
    REWARD: '報酬',
    ALL_CLEARED_BONUS: '全達成ボーナス',
    NEW: '新規',

    // Profile
    PROFILE_TITLE: 'PROFILE',
    LOADING: '読み込み中…',
    ACCOUNT_INFO: 'アカウント情報',
    CURRENT_EMAIL: '現在のメール',
    PROFILE_INFO: 'プロフィール情報',
    WEIGHT: '体重(kg)',
    HEIGHT: '身長(cm)',
    AGE: '年齢',
    GENDER: '性別',
    MALE: '男性',
    FEMALE: '女性',
    TARGET_WEIGHT: '目標体重(kg)',
    TARGET_CALORIES: '目標カロリー(kcal)',
    UPDATE_OK: '更新が完了しました。',
    UPDATE_FAIL: '更新に失敗しました。',
    EMAIL_INVALID: 'メール形式が正しくありません。',
    PW_TOO_SHORT: '新しいパスワードは8文字以上が必要です。',
    PW_MISMATCH: 'パスワード確認が一致しません。',
    NUMERIC_ONLY: '数値を入力してください。',

    // Quest/Ranking
    DONE: '完了',
    AUTO: '自動',
    LOCATION_OK: '位置情報は使用可能',
    LOCATION_NEEDED: '権限が必要：位置情報',
    ANDROID_LOCATION_HINT: '高精度推奨、バッテリー最適化の除外を推奨',
    ANDROID_ACCURACY_HINT: '高精度推奨、バッテリー最適化の除外を推奨', // ✅ 追加
    OPEN_SETTINGS: '設定を開く',
    RANKING_EMPTY: '表示するランキングがありません。',
    LIST_LOAD_FAIL: 'リストの読み込みに失敗しました。',
    USERS_EMPTY: '表示するユーザーがありません。',
  },

  zh: {
    LOGIN: '登录',
    SIGNUP: '注册',
    EMAIL: '邮箱',
    PASSWORD: '密码',
    PASSWORD_MIN: '密码（至少8位）',
    PASSWORD_CONFIRM: '确认新密码',
    INPUT_REQUIRED: '需要输入',
    ENTER_ID_PW: '请输入邮箱和密码。',
    INVALID_CREDENTIALS: '邮箱或密码不正确。',
    TRY_AGAIN: '请重试。',
    START: '开始',
    HOME_MEAL: '🥗 饮食记录',
    HOME_DATA: '👀 一览',
    PROFILE: 'PROFILE',
    QUEST: 'QUEST',
    RANKING: 'RANKING',
    SETTINGS: 'SETTINGS',
    CAMERA: '相机',
    CAMERA_HINT: '请将餐盘对准画面中心',
    PERMISSION_CAMERA_NEEDED: '需要相机权限',
    PERMISSION_ALLOW: '允许',
    SAVE: '保存',
    RETAKE: '重拍',
    RESULT: '结果',
    GOAL_SETUP: '目标设置',
    LATER: '稍后设置',
    CONFIRM: '确定',
    CANCEL: '取消',
    EDIT: '编辑',
    EDIT_DONE: '已保存',
    FETCHING: '加载中…',
    NO_LIST: '无可显示内容。',
    LOGOUT: '退出登录',
    LANGUAGE: '语言',
    SOUND: '音效',
    ON: '开',
    OFF: '关',
    RECOVERY: '找回密码',
    RECOVERY_SETUP: '安全问题',
    RECOVERY_START_DESC: '输入邮箱后将出现2个问题。',
    RECOVERY_ID: '邮箱',
    RECOVERY_START: '获取问题',
    RECOVERY_ANSWER: '提交答案',
    RECOVERY_NEW_PW: '新密码',
    RECOVERY_RESET: '重置密码',
    RECOVERY_REGISTER_DESC: '选择3个问题并登记答案/确认。',
    QUESTION_BIRTHPLACE: '我出生在？',
    QUESTION_ELEMENTARY_SCHOOL: '我的小学？',
    QUESTION_PET_NAME: '我的宠物名字？',
    QUESTION_MOTHER_NAME: '我母亲的名字？',
    ANSWER: '答案',
    ANSWER_CONFIRM: '确认',
    SEND: '发送',
    WALK: '步行',
    PUSHUP: '俯卧撑',
    SQUAT: '深蹲',
    DIET: '饮食',
    DAILY_QUESTS: '今天的日常任务',
    REWARD: '奖励',
    ALL_CLEARED_BONUS: '全完成奖励',
    NEW: '新',

    // Profile
    PROFILE_TITLE: 'PROFILE',
    LOADING: '加载中…',
    ACCOUNT_INFO: '账户信息',
    CURRENT_EMAIL: '当前邮箱',
    PROFILE_INFO: '个人资料',
    WEIGHT: '体重(kg)',
    HEIGHT: '身高(cm)',
    AGE: '年龄',
    GENDER: '性别',
    MALE: '男',
    FEMALE: '女',
    TARGET_WEIGHT: '目标体重(kg)',
    TARGET_CALORIES: '目标卡路里(kcal)',
    UPDATE_OK: '已成功更新。',
    UPDATE_FAIL: '更新失败。',
    EMAIL_INVALID: '邮箱格式不正确。',
    PW_TOO_SHORT: '新密码至少需要8位。',
    PW_MISMATCH: '两次输入的密码不一致。',
    NUMERIC_ONLY: '请输入数字。',

    // Quest/Ranking
    DONE: '完成',
    AUTO: '自动',
    LOCATION_OK: '定位可用',
    LOCATION_NEEDED: '需要权限：定位',
    ANDROID_LOCATION_HINT: '建议高精度，并从电池优化中排除',
    ANDROID_ACCURACY_HINT: '建议高精度，并从电池优化中排除', // ✅ 追加
    OPEN_SETTINGS: '打开设置',
    RANKING_EMPTY: '暂无可显示的排行榜。',
    LIST_LOAD_FAIL: '列表加载失败。',
    USERS_EMPTY: '暂无可显示的用户。',
  },
};

const Ctx = createContext(null);
export const useI18n = () => useContext(Ctx);

export function I18nProvider({ children }) {
  const [lang, setLang] = useState('ko');

  useEffect(() => {
    (async () => {
      const v = await AsyncStorage.getItem('@i18n/lang');
      if (v) setLang(v);
    })();
  }, []);

  const t = useMemo(() => {
    const table = DICT[lang] || DICT.ko;
    return (key) => {
      const k = String(key || '').trim();
      return table[k] || k;
    };
  }, [lang]);

  const value = useMemo(() => ({
    lang,
    t,
    setLang: async (next) => {
      const v = ['ko','en','ja','zh'].includes(next) ? next : 'ko';
      setLang(v);
      try { await AsyncStorage.setItem('@i18n/lang', v); } catch {}
    }
  }), [lang, t]);

  return <Ctx.Provider value={value}>{children}</Ctx.Provider>;
}
